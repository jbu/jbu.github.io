<!doctype html><html lang=en-us><head><title>Lunchtime Hack - Lets Run Science | James Uther</title><meta charset=utf-8><meta name=language content="en"><meta name=description content><meta name=keywords content><meta name=viewport content="width=device-width,initial-scale=1"><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=twitter:card content="summary"><meta name=twitter:title content="Lunchtime Hack - Lets Run Science"><meta name=twitter:description content><meta name=twitter:site content="https://twitter.com/hemul"><meta name=twitter:creator content="https://twitter.com/hemul"><link rel="shortcut icon" type=image/png href=https://uther.wtf/favicon.ico><link type=text/css rel=stylesheet href=https://uther.wtf/css/post.min.86d1effd4c412b85ac13db53a90c473a0f256f789b821e131125c9aa25cb6a6d.css integrity="sha256-htHv/UxBK4WsE9tTqQxHOg8lb3ibgh4TESXJqiXLam0="><link type=text/css rel=stylesheet href=https://uther.wtf/css/custom.min.e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855.css integrity="sha256-47DEQpj8HBSa+/TImW+5JCeuQeRkm5NMpJWZG3hSuFU="><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/uther.wtf"},"articleSection":"blog","name":"Lunchtime Hack - Lets Run Science","headline":"Lunchtime Hack - Lets Run Science","description":"","inLanguage":"en-US","author":"","creator":"","publisher":"","accountablePerson":"","copyrightHolder":"","copyrightYear":"2015","datePublished":"2015-02-27 00:00:00 \u002b0000 UTC","dateModified":"2015-02-27 00:00:00 \u002b0000 UTC","url":"https:\/\/uther.wtf\/blog\/lets-run-science\/","wordCount":"801","keywords":["Blog"]}</script><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","G-H1BFBWHPF6","auto"),ga("send","pageview"))</script><script async src=https://www.google-analytics.com/analytics.js></script></head><body><div class=burger__container><div class=burger aria-controls=navigation aria-label=Menu><div class="burger__meat burger__meat--1"></div><div class="burger__meat burger__meat--2"></div><div class="burger__meat burger__meat--3"></div></div></div><nav class=nav id=navigation><ul class=nav__list><li><a href=https://uther.wtf/>Home</a></li><li><a href=https://uther.wtf/cv>Curriculum vitae</a></li><li><a class=active href=https://uther.wtf/blog>blog</a></li></ul></nav><main><div class=flex-wrapper><div class=post__container><div class=post><header class=post__header><h1 id=post__title>Lunchtime Hack - Lets Run Science</h1><time datetime="2015-02-27 00:00:00 +0000 UTC" class=post__date>2015-02-27</time></header><article class=post__content><p>Possibly part 1.</p><p>Who else likes visiting science museums? All those old apparatus – bits of the radio telescope that first saw pulsars, longitude prize clocks, jury-rigged ingenious devices that captured the first glimpse of something new and exciting. One day the LHC will be dismantled, carved up and shipped to museums around the world. For a lunchtime hack I’m going to go and have a look at something along those lines, but software.</p><p>Climate records have been collected in one form or another for hundreds of years (<a href=http://www.realclimate.org/index.php/data-sources/#Climate_data_raw target=_blank rel="noreferrer noopener">here are some</a>)
and we can get proxies going back <a href=http://www.ncdc.noaa.gov/data-access/paleoclimatology-data/datasets target=_blank rel="noreferrer noopener">way further</a>. Collecting this data has been the sort of heroic grunt-work of real science.</p><p>But if you thought the sales data you’re trying to analyse is a mess, you lead a sheltered life! One of the apparatus that has really made a scientific and social impact over the last few decades has been methods, implemented in code, for pulling these data sets into something that can show whether or not the earth’s temperature is changing, and with a bit more work, why. So let’s go and visit one of these devices and take it for a spin.</p><p>There are a few of these things to choose from. <a href=http://berkeleyearth.org/land-and-ocean-data target=_blank rel="noreferrer noopener">Berkeley Earth</a> is a recent one but it’s all in matlab which I don’t have installed, so move on. <a href=http://data.giss.nasa.gov/gistemp/ target=_blank rel="noreferrer noopener">GISTEMP</a> from NASA is another major look at surface temperature. Ahh, it has downloadable code and data that looks mostly python and a bit of fortran. Let’s see what we can get running.</p><p>I’m expecting (and found) bitrot. Docker seems like it would be a useful way of preserving these sorts of projects, because it can manage the runtime dependencies, so I’m going to build a docker image of my work (and a <code>run.sh</code>) as I go. You can get it <a href=https://github.com/jbu/gistemp-docker target=_blank rel="noreferrer noopener">here</a>. Build this container, run it (and be dropped into the shell) with <code>./build.sh</code>. Then run <code>./gistemp.sh</code>. You’ll need <code>docker</code> and <code>docker-machine</code>.</p><p>So, the readmees are pretty clear. Some data needs to be fetched and some of the URLs have changed slightly but it’s easy enough to track down. It takes in data from GHCNv3 (Global Historical Climate Network from NOAA) and Antarctic SCAR (Scientific Committee on Antarctic Research) data.</p><p>Step 0, which merges the sources:</p><pre><code class=language-bash>$ do_comb_step0.sh
reformatting to v2 format
Bringing Antarctic tables closer to v2.mean format
collecting surface station data
... and autom. weather stn data
... and australian data
replacing '-' by -999.9, blanks are left alone at this stage
adding extra Antarctica station data to input_files/v3.mean
created v2.meanx from v2_antarct.dat and input_files/v3.mean

GHCN data:
 removing data before year   1880.00000
created v2.meanz from v2.meanx
replacing Hohenspeissenberg data in v3.mean by more complete data (priv.comm.)
disregard pre-1880 data:

created v3.mean_comb
move files from temp_files/. to ../STEP1/temp_files/.
and execute in the STEP1 directory the command:
   do_comb_step1.sh v3.mean_comb
</code></pre><p>Now, Step 1 ‘eliminates some dubious records’. It has some python extensions that need to be compiled – In fact I end up patching it slightly and moving to setup.py. But then</p><pre><code class=language-bash>Creating v3.mean_comb.bdb
reading v3.mean_comb
reading v3.inv
writing v3.mean_comb.bdb
Dropping strange data
reading Ts.strange.RSU.list.IN
reading v3.mean_comb.bdb
writing v3.mean_comb.strange.bdb
reading v3.mean_comb.strange.bdb
creating v3.mean_comb.strange.txt
1000
2000
...
created Ts.txt
move this file from STEP1/temp_files to STEP2/temp_files
and execute in the STEP2 directory the command:
   do_comb_step2.sh last_year_with_data
</code></pre><p>Step 2: Splitting into zonal sections and homogenization. This compares rural and urban stations to remove any effect of the urban environment.</p><pre><code class=language-bash>converting text to binary file
 last year with data:        2013  LightGl=           1
        1000 processed so far
        2000 processed so far
        3000 processed so far
        4000 processed so far
        5000 processed so far
        6000 processed so far
        7000 processed so far
 number of station ids:        7354
 ...
 created Ts.GHCN.CL.* files
move them from STEP2/temp_files to STEP3/temp_files
and execute in STEP3 do_comb_step3.sh
</code></pre><p>and then</p><p>Step 3 : Gridding and computation of zonal means</p><p>&mldr;</p><p>gives us a file <code>SBBX1880.Ts.GHCN.CL.PA.1200</code> which is a nasty fortran blob that apparently contains the grid of surface temperature anomalies. Great! Let’s plot that! There are some files at nasa (linked in the build/run scripts here) that can convert this <code>SBBX</code> file to a <code>NetCDF</code> file that can be viewed. Problem is, the programs supplied take some memory. In fact, a few random checks suggest 10s of Gigs, which is beyond my macbook. So let’s leave it here… But what we were shooting for was</p><p><img src=https://uther.wtf/lets-run-science.gif alt="Geo plot"></p><p>So there you are. Just like repeating a cloud-chamber experiment in school physics we haven’t actually learned anything that hasn’t already been published and pored over. We haven’t actually looked at the code to really see what it’s doing.</p><p>But, I now have a major bit of science history (from NASA!) running (mostly) on my laptop. That’s at least a bit cool.</p><p>Also, docker has more uses than you think.</p><p>(Originally <a href=http://web.archive.org/web/20161006160845/http://www.lshift.net/blog/2015/02/27/lunchtime-hack-lets-run-science/ target=_blank rel="noreferrer noopener">http://web.archive.org/web/20161006160845/http://www.lshift.net/blog/2015/02/27/lunchtime-hack-lets-run-science/</a>)</p></article><div class=pagination><a class=pagination__item href=https://uther.wtf/blog/open-nhs-data/><span class=pagination__label>Previous Post</span>
<span class=pagination__title>Playing with open NHS data, and a rant</span></a>
<a class=pagination__item href=https://uther.wtf/blog/lets-run-science-part-iota/><span class=pagination__label>Next Post</span>
<span class=pagination__title>Lets Run Science Part Iota</span></a></div><footer class=post__footer><div class=social-icons><a class=social-icons__link title=Twitter href=https://twitter.com/hemul target=_blank rel="me noopener"><div class=social-icons__icon style=background-image:url(https://uther.wtf/svg/twitter.svg)></div></a><a class=social-icons__link title=GitHub href=https://github.com/jbu target=_blank rel="me noopener"><div class=social-icons__icon style=background-image:url(https://uther.wtf/svg/github.svg)></div></a><a class=social-icons__link title=LinkedIn href=https://www.linkedin.com/in/jamesuther/ target=_blank rel="me noopener"><div class=social-icons__icon style=background-image:url(https://uther.wtf/svg/linkedin.svg)></div></a></div><p>© 2022</p></footer></div></div></div></main><script src=https://uther.wtf/js/index.min.301a8b0870381bf76b3b5182e8966d363a0474281183439beb024d8b8228fc66.js integrity="sha256-MBqLCHA4G/drO1GC6JZtNjoEdCgRg0Ob6wJNi4Io/GY=" crossorigin=anonymous></script>
<script src=https://unpkg.com/prismjs@1.20.0/components/prism-core.min.js></script>
<script src=https://unpkg.com/prismjs@1.20.0/plugins/autoloader/prism-autoloader.min.js data-autoloader-path=https://unpkg.com/prismjs@1.20.0/components/></script></body></html>